<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Converge MVP Test - Blok 2</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #status-area {
            margin-bottom: 20px;
            font-size: 1.2em;
            height: 25px; 
            color: #00ff88;
        }
        #score-area {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5em;
        }
        #game-container {
            position: relative;
            width: 500px;
            height: 500px;
            border: 1px solid #333;
            background-color: #111;
        }
        .dot {
            position: absolute;
            width: 40px; 
            height: 40px; 
            cursor: pointer; 
            transition: background-color 0.1s, transform 0.1s;
            z-index: 100;
            display: none; /* Standaard verborgen */
        }
        #dot1 {
            background-color: #00ff88; /* Groen */
            display: block; /* Blok 1 is direct zichtbaar */
        }
        #dot2 {
            background-color: #ffaa00; /* Oranje: NIEUW */
        }
        .footprint {
            position: absolute;
            width: 15px; 
            height: 15px; 
            background-color: #333;
            opacity: 0.5;
            z-index: 5;
        }
        #try-again-btn {
            padding: 10px 20px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #f00;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
    </style>
</head>
<body>

<div id="score-area">Cyclus Voltooid: <span id="score-value">0</span></div>
<div id="status-area">Wacht op beweging...</div>
<div id="game-container">
    <div id="dot1" class="dot"></div>
    <div id="dot2" class="dot"></div> </div>
<button id="try-again-btn">Try Again</button>

<script>
    const container = document.getElementById('game-container');
    const dot1 = document.getElementById('dot1');
    const dot2 = document.getElementById('dot2'); // *** NIEUW BLOK 2 ***
    const scoreValue = document.getElementById('score-value');
    const statusArea = document.getElementById('status-area');
    const tryAgainBtn = document.getElementById('try-again-btn');
    
    const gridSize = 10; 
    const unitSize = container.offsetWidth / gridSize;
    const movementSpeed = 750; // *** AANGEPAST: 500ms -> 750ms ***
    
    let currentPos1 = { x: 5, y: 5 };
    let currentPos2 = { x: 0, y: 0 }; // *** NIEUW BLOK 2 ***
    
    // --- PATRONEN DEFINITIE ---
    // Blok 1: Pendelaar
    const pattern1 = [
        { dx: 1, dy: 0 }, { dx: 0, dy: 1 },
        { dx: -1, dy: 0 }, { dx: 0, dy: 1 },
        { dx: 1, dy: 0 }, { dx: 0, dy: 1 },
        { dx: -1, dy: 0 }, { dx: 0, dy: 1 },
        { dx: 1, dy: 0 }, { dx: 0, dy: 1 }
    ];
    // Blok 2: Spiraal (10 stappen)
    const pattern2 = [ 
        { dx: 2, dy: 0 }, { dx: 0, -1 }, 
        { dx: -1, dy: 0 }, { dx: 0, -1 }, 
        { dx: -1, dy: 0 }, { dx: 0, 1 }, 
        { dx: 1, dy: 0 }, { dx: 0, 1 }, 
        { dx: 1, dy: 0 }, { dx: 0, 0 } // Laatste stap is stilstand
    ]; // *** NIEUW BLOK 2 PATROON ***

    let stepCount1 = 0;
    let stepCount2 = 0; // *** NIEUW BLOK 2 ***
    let isMoving1 = true;
    let isMoving2 = false; // *** NIEUW BLOK 2: Start niet direct ***
    let intervalId1;
    let intervalId2; // *** NIEUW BLOK 2 ***
    let score = 0;

    // --- HELPER FUNCTIES ---

    function updateStatus(message, color = '#00ff88') {
        statusArea.textContent = message;
        statusArea.style.color = color;
    }

    function updateDotPosition(dotElement, gridX, gridY) {
        const left = (gridX * unitSize) - (dotElement.offsetWidth / 2);
        const top = (gridY * unitSize) - (dotElement.offsetHeight / 2);
        dotElement.style.left = `${left}px`;
        dotElement.style.top = `${top}px`;
    }

    function placeFootprint(x, y) {
        const fp = document.createElement('div');
        fp.className = 'footprint';
        container.appendChild(fp);
        const left = (x * unitSize) - (fp.offsetWidth / 2);
        const top = (y * unitSize) - (fp.offsetHeight / 2);
        fp.style.left = `${left}px`;
        fp.style.top = `${top}px`;
    }

    function checkBoundaries(x, y) {
        x = Math.max(1, Math.min(gridSize, x));
        y = Math.max(1, Math.min(gridSize, y));
        return { x: x, y: y };
    }

    // --- CORE GAME LOGICA ---
    
    // Functie voor herstart/initialisatie van Blok 1
    function startDot1Movement() {
        tryAgainBtn.style.display = 'none'; 
        
        currentPos1 = { x: 5, y: 5 };
        isMoving1 = true;
        stepCount1 = 0;
        dot1.style.backgroundColor = '#00ff88';

        updateDotPosition(dot1, currentPos1.x, currentPos1.y);
        clearInterval(intervalId1); 
        intervalId1 = setInterval(moveDot1, movementSpeed);
        updateStatus("Blok 1 beweegt. Klik op tijd!", '#00ff88');
    }

    // Functie voor initiÃ«le start van Blok 2
    function initializeDot2() {
        if(isMoving2) return; // Al gestart

        currentPos2 = { x: 2, y: 9 }; // Startpositie Spiraal
        isMoving2 = true;
        stepCount2 = 0;
        dot2.style.backgroundColor = '#ffaa00';
        dot2.style.display = 'block';

        updateDotPosition(dot2, currentPos2.x, currentPos2.y);
        intervalId2 = setInterval(moveDot2, movementSpeed);
        updateStatus("Blok 2 verschenen! Beheer twee blokken.", '#ffaa00');
    }

    // Functie voor herstart van Blok 2 na succesvolle klik
    function restartDot2Cycle() {
        stepCount2 = 0;
        isMoving2 = true;
        dot2.style.backgroundColor = '#ffaa00'; 
        clearInterval(intervalId2);
        intervalId2 = setInterval(moveDot2, movementSpeed);
    }


    // Algemene Faal-logica (nu voor beide blokken)
    function failGame() {
        clearInterval(intervalId1);
        clearInterval(intervalId2);
        isMoving1 = false;
        isMoving2 = false;
        dot1.style.backgroundColor = '#ff0000'; 
        dot2.style.backgroundColor = '#ff0000'; // Rood
        updateStatus("MISLUKT: Een van de blokken was te laat! Druk op 'Try Again'.", '#ff0000');
        tryAgainBtn.style.display = 'block';
    }


    // --- BEWEGINGSLUSSEN ---

    function moveDot1() {
        if (!isMoving1) return;

        const step = pattern1[stepCount1 % pattern1.length];
        
        let newPos = checkBoundaries(currentPos1.x + step.dx, currentPos1.y + step.dy);
        currentPos1 = newPos;
        updateDotPosition(dot1, currentPos1.x, currentPos1.y);

        stepCount1++;
        // updateStatus(`Blok 1: ${stepCount1}, Blok 2: ${stepCount2}`);

        if (stepCount1 >= pattern1.length) {
            failGame();
        }
    }

    function moveDot2() { // *** NIEUW BLOK 2 BEWEGING ***
        if (!isMoving2) return;

        const step = pattern2[stepCount2 % pattern2.length];
        
        let newPos = checkBoundaries(currentPos2.x + step.dx, currentPos2.y + step.dy);
        currentPos2 = newPos;
        updateDotPosition(dot2, currentPos2.x, currentPos2.y);

        stepCount2++;
        // updateStatus(`Blok 1: ${stepCount1}, Blok 2: ${stepCount2}`);

        if (stepCount2 >= pattern2.length) {
            failGame();
        }
    }

    // --- KLIK HANDLERS ---

    function handleSuccessfulClick(dotElement, currentPos, cycleFinishedMessage) {
        placeFootprint(currentPos.x, currentPos.y);

        // Hier komt straks de Convergentie/Synergie check!
        
        score++;
        scoreValue.textContent = score;
        updateStatus(cycleFinishedMessage, '#00ff88');

        // Check of blok 2 gestart moet worden na de klik van blok 1
        if (dotElement.id === 'dot1' && score === 3 && !isMoving2) { 
            initializeDot2();
        }
    }

    dot1.onclick = function() {
        if (isMoving1 && stepCount1 > 0 && stepCount1 < pattern1.length) {
            handleSuccessfulClick(dot1, currentPos1, `SUCCES: Blok 1 cyclus voltooid! (${score + 1}x)`);
            startDot1Movement(); // Blok 1 cyclus reset
        } else {
            // Dit is nu minder kritisch, want falen wordt afgehandeld door moveDot1/2
            updateStatus("Klik te vroeg of te laat (fout).", '#ffaa00');
        }
    };
    
    dot2.onclick = function() { // *** NIEUWE KLIK HANDLER VOOR BLOK 2 ***
        if (isMoving2 && stepCount2 > 0 && stepCount2 < pattern2.length) {
            handleSuccessfulClick(dot2, currentPos2, `SUCCES: Blok 2 cyclus voltooid! (${score + 1}x)`);
            restartDot2Cycle(); // Blok 2 cyclus reset
        } else {
            updateStatus("Klik te vroeg of te laat (fout).", '#ffaa00');
        }
    };

    tryAgainBtn.onclick = function() {
        startDot1Movement();
        if (dot2.style.display === 'block') {
            initializeDot2(); // Herstart Blok 2 als deze al verschenen was
        }
        score = 0; // Reset score bij Try Again
        scoreValue.textContent = score;
    };

    // Initialisatie: Start alleen Blok 1
    startDot1Movement();
</script>

</body>
</html>
