<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Converge MVP Test - V12 Patroon Geheugen & Geel Blok</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #version-info { 
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.0em;
            color: #555;
        }
        #mode-toggle { /* NIEUW: Schakelaar voor Einstein Mode */
            position: absolute;
            top: 40px;
            left: 20px;
            font-size: 0.9em;
        }
        #status-area {
            margin-bottom: 20px;
            font-size: 1.2em;
            height: 25px;
            color: #00ff88;
        }
        #score-area {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5em;
        }
        #game-container {
            position: relative;
            width: 500px;
            height: 500px;
            border: 1px solid #333;
            background-color: #111;
        }
        .dot {
            position: absolute;
            width: 40px; 
            height: 40px; 
            cursor: pointer; 
            transition: background-color 0.1s, transform 0.1s;
            z-index: 100;
            display: none; 
        }
        #dot1 { background-color: #00ff88; } /* Groen */
        #dot2 { background-color: #ffaa00; } /* Oranje */
        #dot3 { background-color: #ffff00; } /* NIEUW: Geel */

        .footprint { display: none; } 
        
        #try-again-btn {
            padding: 10px 20px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #f00;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
    </style>
</head>
<body>

<div id="version-info">V12</div>
<div id="mode-toggle">
    <input type="checkbox" id="einstein-mode">
    <label for="einstein-mode">Einstein Mode</label>
</div>
<div id="score-area">Cyclus Voltooid: <span id="score-value">0</span></div>
<div id="status-area">Wacht op beweging...</div>
<div id="game-container">
    <div id="dot1" class="dot"></div>
    <div id="dot2" class="dot"></div>
    <div id="dot3" class="dot"></div> </div>
<button id="try-again-btn">Try Again</button>

<script>
    const container = document.getElementById('game-container');
    const dot1 = document.getElementById('dot1');
    const dot2 = document.getElementById('dot2');
    const dot3 = document.getElementById('dot3'); // NIEUW
    const scoreValue = document.getElementById('score-value');
    const statusArea = document.getElementById('status-area');
    const tryAgainBtn = document.getElementById('try-again-btn');
    const einsteinMode = document.getElementById('einstein-mode');
    
    const gridSize = 10; 
    const unitSize = container.offsetWidth / gridSize;
    const movementSpeed = 750;
    
    // --- PATRONEN EN STARTPOSITIES ---
    
    // 1. Mogelijke Patronen
    const PATTERNS = [
        // Patroon 1: Pendelaar
        [{ dx: 1, dy: 0 }, { dx: 0, dy: 1 }, { dx: -1, dy: 0 }, { dx: 0, dy: 1 },
         { dx: 1, dy: 0 }, { dx: 0, dy: 1 }, { dx: -1, dy: 0 }, { dx: 0, dy: 1 },
         { dx: 1, dy: 0 }, { dx: 0, dy: 1 }],
        // Patroon 2: Spiraal
        [{ dx: 2, dy: 0 }, { dx: 0, dy: -2 }, { dx: -2, dy: 0 }, { dx: 0, dy: -2 }, 
         { dx: -1, dy: 0 }, { dx: 0, dy: 1 }, { dx: 1, dy: 0 }, { dx: 0, dy: 1 }, 
         { dx: 1, dy: 0 }, { dx: 0, dy: 0 }],
        // Patroon 3: Diagonaal/Vierkant (10 stappen)
        [{ dx: 1, dy: 1 }, { dx: 1, dy: -1 }, { dx: -1, dy: -1 }, { dx: -1, dy: 1 },
         { dx: 1, dy: 1 }, { dx: 1, dy: -1 }, { dx: -1, dy: -1 }, { dx: -1, dy: 1 },
         { dx: 1, dy: 1 }, { dx: 0, dy: 0 }],
        // Patroon 4: Kleine Cirkel (8 stappen - wordt 10)
        [{ dx: 0, dy: 1 }, { dx: 1, dy: 0 }, { dx: 0, dy: -1 }, { dx: -1, dy: 0 },
         { dx: 0, dy: 1 }, { dx: 1, dy: 0 }, { dx: 0, dy: 0 }, { dx: 0, dy: 0 }, 
         { dx: 0, dy: 0 }, { dx: 0, dy: 0 }]
    ];

    // 2. Mogelijke Startposities (grid 1-10)
    const START_POSITIONS = [
        { x: 5, y: 5 }, { x: 2, y: 9 }, { x: 8, y: 3 }, { x: 1, y: 1 }, { x: 10, y: 10 }
    ];

    // 3. OPGESLAGEN (BEWAARDE) PATRONEN en Posities
    let savedPattern1 = [];
    let savedStartPos1 = { x: 5, y: 5 };
    let savedPattern2 = [];
    let savedStartPos2 = { x: 2, y: 9 };
    let savedPattern3 = [];
    let savedStartPos3 = { x: 8, y: 3 };

    // --- STATE BEHEER ---
    let activeDot = 1;
    let stepCount1 = 0;
    let stepCount2 = 0; 
    let stepCount3 = 0; // NIEUW
    let isMoving1 = false;
    let isMoving2 = false; 
    let isMoving3 = false; // NIEUW
    let intervalId1;
    let intervalId2; 
    let intervalId3; // NIEUW
    let score = 0;

    // --- INITIALISATIE & RESET LOGICA ---

    function initializeGame() {
        // Stop alle timers
        clearInterval(intervalId1);
        clearInterval(intervalId2);
        clearInterval(intervalId3);
        
        // 1. Willekeurige patronen en posities selecteren en opslaan
        
        // Groen: Willekeurige start, willekeurig patroon
        const randIndex1 = Math.floor(Math.random() * PATTERNS.length);
        const randPosIndex1 = Math.floor(Math.random() * START_POSITIONS.length);
        savedPattern1 = PATTERNS[randIndex1];
        savedStartPos1 = START_POSITIONS[randPosIndex1];
        
        // Oranje: Willekeurige start, willekeurig patroon
        const randIndex2 = Math.floor(Math.random() * PATTERNS.length);
        const randPosIndex2 = Math.floor(Math.random() * START_POSITIONS.length);
        savedPattern2 = PATTERNS[randIndex2];
        savedStartPos2 = START_POSITIONS[randPosIndex2];

        // Geel: Willekeurige start, willekeurig patroon
        const randIndex3 = Math.floor(Math.random() * PATTERNS.length);
        const randPosIndex3 = Math.floor(Math.random() * START_POSITIONS.length);
        savedPattern3 = PATTERNS[randIndex3];
        savedStartPos3 = START_POSITIONS[randPosIndex3];

        // Reset state
        score = 0;
        scoreValue.textContent = score;
        activeDot = 1; // Start altijd met Groen
        
        // Start de eerste cyclus
        startDot1Movement();
    }

    // --- HELPER FUNCTIES ---
    // (updateStatus, updateDotPosition, checkBoundaries, clickFeedback blijven hetzelfde)

    function updateStatus(message, color = '#00ff88') {
        statusArea.innerHTML = message;
        statusArea.style.color = color;
    }

    function updateDotPosition(dotElement, gridX, gridY) {
        const left = (gridX * unitSize) - (dotElement.offsetWidth / 2);
        const top = (gridY * unitSize) - (dotElement.offsetHeight / 2);
        dotElement.style.left = `${left}px`;
        dotElement.style.top = `${top}px`;
    }

    function checkBoundaries(x, y) {
        x = Math.max(1, Math.min(gridSize, x));
        y = Math.max(1, Math.min(gridSize, y));
        return { x: x, y: y };
    }

    function clickFeedback(dotElement, originalColor) {
        dotElement.style.backgroundColor = '#fff';
        setTimeout(() => {
            dotElement.style.backgroundColor = originalColor;
        }, 250); 
    }

    // --- START FUNCTIES VOOR ELK BLOK ---

    function startDotMovement(dot, startPos, pattern, color, dotIndex, intervalIdRef) {
        // Stop alle blokken
        [dot1, dot2, dot3].forEach(d => d.style.display = 'none');
        isMoving1 = isMoving2 = isMoving3 = false;
        clearInterval(intervalId1);
        clearInterval(intervalId2);
        clearInterval(intervalId3);

        // Start de actieve blok
        activeDot = dotIndex;
        
        if (dotIndex === 1) { currentPos1 = { ...startPos }; isMoving1 = true; stepCount1 = 0; }
        if (dotIndex === 2) { currentPos2 = { ...startPos }; isMoving2 = true; stepCount2 = 0; }
        if (dotIndex === 3) { currentPos3 = { ...startPos }; isMoving3 = true; stepCount3 = 0; } // NIEUW
        
        dot.style.backgroundColor = color;
        dot.style.display = 'block';

        updateDotPosition(dot, startPos.x, startPos.y);
        
        // De bewegingslus wordt hieronder gedefinieerd om de juiste patroon/state te gebruiken
        const moveFunction = (dotIndex === 1) ? moveDot1 : 
                             (dotIndex === 2) ? moveDot2 : moveDot3;
        
        return setInterval(moveFunction, movementSpeed);
    }
    
    // Publieke startfuncties die de opgeslagen patronen gebruiken
    function startDot1Movement() {
        intervalId1 = startDotMovement(dot1, savedStartPos1, savedPattern1, '#00ff88', 1, intervalId1);
        updateStatus("Aan de beurt: Blok 1 (Groen). Onthoud het patroon!", '#00ff88');
    }
    function startDot2Movement() {
        intervalId2 = startDotMovement(dot2, savedStartPos2, savedPattern2, '#ffaa00', 2, intervalId2);
        updateStatus("Aan de beurt: Blok 2 (Oranje). Onthoud het patroon!", '#ffaa00');
    }
    function startDot3Movement() { // NIEUW
        intervalId3 = startDotMovement(dot3, savedStartPos3, savedPattern3, '#ffff00', 3, intervalId3);
        updateStatus("Aan de beurt: Blok 3 (Geel). Onthoud het patroon!", '#ffff00');
    }

    // --- BEWEGINGSLUSSEN (Gebruiken nu de bewaarde patronen) ---

    function moveDot1() {
        if (!isMoving1) return;
        const pattern = savedPattern1;
        
        const step = pattern[stepCount1 % pattern.length];
        
        let newPos = checkBoundaries(currentPos1.x + step.dx, currentPos1.y + step.dy);
        currentPos1 = newPos;
        updateDotPosition(dot1, currentPos1.x, currentPos1.y);

        stepCount1++;

        if (stepCount1 >= pattern.length) {
            failGame();
        }
    }

    function moveDot2() { 
        if (!isMoving2) return;
        const pattern = savedPattern2;

        const step = pattern[stepCount2 % pattern.length];
        
        let newPos = checkBoundaries(currentPos2.x + step.dx, currentPos2.y + step.dy);
        currentPos2 = newPos;
        updateDotPosition(dot2, currentPos2.x, currentPos2.y);

        stepCount2++;

        if (stepCount2 >= pattern.length) {
            failGame();
        }
    }
    
    function moveDot3() { // NIEUW
        if (!isMoving3) return;
        const pattern = savedPattern3;
        
        const step = pattern[stepCount3 % pattern.length];
        
        let newPos = checkBoundaries(currentPos3.x + step.dx, currentPos3.y + step.dy);
        currentPos3 = newPos;
        updateDotPosition(dot3, currentPos3.x, currentPos3.y);

        stepCount3++;

        if (stepCount3 >= pattern.length) {
            failGame();
        }
    }

    // --- KLIK HANDLERS & SEQUENTIELE FLOW ---

    dot1.onclick = function() {
        if (isMoving1 && stepCount1 > 0 && stepCount1 < savedPattern1.length) {
            clickFeedback(dot1, '#00ff88');
            score++;
            scoreValue.textContent = score;
            startDot2Movement(); // Groen -> Oranje
        }
    };
    
    dot2.onclick = function() { 
        if (isMoving2 && stepCount2 > 0 && stepCount2 < savedPattern2.length) {
            clickFeedback(dot2, '#ffaa00');
            score++;
            scoreValue.textContent = score;
            startDot3Movement(); // Oranje -> Geel
        }
    };
    
    dot3.onclick = function() { // NIEUW
        if (isMoving3 && stepCount3 > 0 && stepCount3 < savedPattern3.length) {
            clickFeedback(dot3, '#ffff00');
            score++;
            scoreValue.textContent = score;
            startDot1Movement(); // Geel -> Groen (cyclus gesloten)
        }
    };

    // --- RESET LOGICA (Einstein Mode) ---

    tryAgainBtn.onclick = function() {
        if (einsteinMode.checked) {
            // Einstein Mode: Begin totaal opnieuw met nieuwe willekeurige patronen
            updateStatus("Einstein Mode: Nieuwe patronen geladen!", '#ff00ff');
            initializeGame(); 
        } else {
            // Normale Mode: Herstart de cyclus met de OPGESLAGEN patronen
            tryAgainBtn.style.display = 'none';
            score = 0;
            scoreValue.textContent = score;
            
            // Start het blok dat aan de beurt was
            if (activeDot === 1) startDot1Movement();
            else if (activeDot === 2) startDot2Movement();
            else if (activeDot === 3) startDot3Movement();
        }
    };

    // Initialisatie van het spel
    initializeGame();
</script>

</body>
</html>
